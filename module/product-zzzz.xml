<?xml version="1.0" encoding="ISO-8859-1"?>

<product productid="zzzz" active="1">
	<title>Test</title>
	<description>test</description>
	<version>0.2</version>
	<url />
	<versioncheckurl />
	<dependencies>
	</dependencies>
	<codes>
		<code version="*">
			<installcode><![CDATA[$queries = array();
$queries[] = sprintf('CREATE TABLE %sraid_guilds (id smallint(5) unsigned NOT NULL AUTO_INCREMENT, name varchar(64) CHARACTER SET cp1251 COLLATE cp1251_general_cs NOT NULL, PRIMARY KEY (id)) ENGINE=MyISAM', TABLE_PREFIX);
$queries[] = sprintf('CREATE TABLE %sraid_roster (gid smallint(5) unsigned NOT NULL, uid bigint(20) unsigned NOT NULL, rid smallint(5) unsigned NOT NULL, fid smallint(5) unsigned DEFAULT NULL, rank` tinyint(3) unsigned NOT NULL, UNIQUE KEY uid (uid), KEY gid (gid), KEY fid (fid), KEY rid (rid), KEY rank (rank)) ENGINE=MyISAM', TABLE_PREFIX);
$queries[] = sprintf('ALTER TABLE %suser ADD raid_approve ENUM("none", "approve", "denied") NOT NULL DEFAULT "none", ADD INDEX (raid_approve)', TABLE_PREFIX);
$queries[] = sprintf('CREATE TABLE %sraid_unit (id smallint(5) unsigned NOT NULL AUTO_INCREMENT, unit_type enum('raid','firm') COLLATE utf8_unicode_ci NOT NULL, name varchar(64) CHARACTER SET cp1251 COLLATE cp1251_general_cs NOT NULL, gid smallint(5) unsigned NOT NULL, PRIMARY KEY (id), KEY unit_type (unit_type), KEY gid (gid)) ENGINE=MyISAM', TABLE_PREFIX);

foreach ($queries as $query)
    $db->query_write($query);]]></installcode>
			<uninstallcode><![CDATA[$queries = array();
$queries[] = sprintf('DROP TABLE IF EXISTS %sraid_guilds', TABLE_PREFIX);
$queries[] = sprintf('DROP TABLE IF EXISTS %sraid_roster', TABLE_PREFIX);
$queries[] = sprintf('ALTER TABLE %suser DROP INDEX raid_approve', TABLE_PREFIX);
$queries[] = sprintf('ALTER TABLE %suser DROP raid_approve', TABLE_PREFIX);
$queries[] = sprintf('DROP TABLE IF EXISTS %sraid_unit', TABLE_PREFIX);

foreach ($queries as $query)
    $db->query_write($query);]]></uninstallcode>
		</code>
	</codes>
	<templates>
	</templates>
	<stylevardfns>
	</stylevardfns>
	<stylevars>
	</stylevars>
	<plugins>
		<plugin active="1" executionorder="5">
			<title>test_admin</title>
			<hookname>admin_index_navigation</hookname>
			<phpcode><![CDATA[if ($_REQUEST['do'] == 'nav' && can_administer('canadminsettings')) {
   $navigation[-1] = array(
       'Сообщество' => array(
            'options' => array(
                 array(
                     'Списки' => array(
                           'displayorder'=>0,
                           'phrase'=>'roster',
                           'link'=>'raid_admin.php?raid_action=roster',
                           'text'=>'Списки',
                      )
                 ),
                 array(
                     'Гильдии' => array(
                           'displayorder'=>1,
                           'phrase'=>'guilds',
                           'link'=>'raid_admin.php?raid_action=guilds',
                           'text'=>'Гильдии',
                      )
                 ),
             ),
            'group' => array(
                  'phrase' => 'settings',
                  'permissions' => 'canadminsettings',
                  'hr' => 'true',
                  'displayorder' => 10,
                  'nav_file' => 'vbulletin',
                  'text' => 'Сообщество'
            ),
        )
   );
}]]></phpcode>
		</plugin>
		<plugin active="1" executionorder="5">
			<title>test</title>
			<hookname>process_templates_complete</hookname>
			<phpcode><![CDATA[if ($vbulletin->userinfo['userid'] > 0) {
    $raid_tab = sprintf('<li%s><a class="navtab" href="raid.php">Список сообщества</a></li>', THIS_SCRIPT == 'raid' ? ' class="selected"' : null);
    $template_hook['navtab_end'] .= $raid_tab;
}]]></phpcode>
		</plugin>
	</plugins>
	<phrases>
	</phrases>
	<options>
	</options>
	<helptopics>
	</helptopics>
	<cronentries>
	</cronentries>
	<faqentries>
	</faqentries>
</product>
